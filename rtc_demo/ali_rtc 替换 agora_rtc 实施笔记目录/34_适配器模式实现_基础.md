# 适配器模式实现 - 1: 抽象接口

## 统一 RTC 客户端接口

```typescript
// interfaces/IRTCClient.ts
export interface IRTCClient {
  join(channel: string, token: string, uid: string): Promise<void>;
  leave(): Promise<void>;
  createAudioTrack(): Promise<IAudioTrack>;
  createVideoTrack(): Promise<IVideoTrack>;
  publish(): Promise<void>;
  destroy(): void;
  on(event: string, handler: Function): void;
  off(event: string, handler: Function): void;
}

export interface IAudioTrack {
  play(element?: HTMLElement): void;
  stop(): void;
  close(): void;
  setEnabled(enabled: boolean): void;
  getEnabled(): boolean;
}

export interface IVideoTrack {
  play(element?: HTMLElement): void;
  stop(): void;
  close(): void;
  setEnabled(enabled: boolean): void;
  getEnabled(): boolean;
}

export interface IRTCTokenService {
  generateToken(channel: string, uid: string): Promise<string>;
}
```

## 事件类型定义

```typescript
// interfaces/IRTCEvents.ts
export interface IRTCEvents {
  "user-joined": (user: IUser) => void;
  "user-left": (user: IUser) => void;
  "user-published": (user: IUser, mediaType: string) => void;
  "user-unpublished": (user: IUser) => void;
  "connection-state-change": (curState: string, prevState: string) => void;
  "network-quality": (stats: INetworkQuality) => void;
  error: (error: IRTCError) => void;
}

export interface IUser {
  uid: string;
  hasAudio: boolean;
  hasVideo: boolean;
}

export interface INetworkQuality {
  downlinkNetworkQuality: number;
  uplinkNetworkQuality: number;
}

export interface IRTCError {
  code: string;
  message: string;
  data?: any;
}
```

## 配置接口定义

```typescript
// interfaces/IRTCConfig.ts
export interface IRTCConfig {
  rtcType: "agora" | "ali";
  agora: {
    appId: string;
  };
  ali: {
    appId: string;
  };
}

export interface IRTCJoinOptions {
  channel: string;
  token: string;
  uid: string;
  userName?: string;
}
```
