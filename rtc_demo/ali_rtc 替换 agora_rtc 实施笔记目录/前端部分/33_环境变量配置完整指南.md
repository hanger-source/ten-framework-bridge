# 环境变量配置完整指南

## 0. 重要发现：阿里云RTC替换Agora RTC

通过分析代码发现，系统需要将Agora RTC完全替换为阿里云RTC，这要求：

1. **完全替换**: 将现有的Agora RTC配置替换为阿里云RTC配置
2. **移除Agora配置**: 删除所有Agora RTC相关的配置项
3. **新增阿里云配置**: 添加阿里云RTC的配置项
4. **环境隔离**: 开发、测试、生产环境使用不同的配置

## 1. 前端环境变量配置

### 1.1 .env 文件配置

**修改文件**: `ai_agents/playground/.env`

**修改前**:

```bash
# ai_agents/playground/.env
NEXT_PUBLIC_AGORA_APP_ID=your_agora_app_id
```

**修改后**:

```bash
# ai_agents/playground/.env
# 阿里云 RTC 配置
NEXT_PUBLIC_ALI_RTC_APP_ID=your_ali_rtc_app_id
NEXT_PUBLIC_ALI_RTC_APP_KEY=your_ali_rtc_app_key
```

### 1.2 .env.local 文件配置

**修改文件**: `ai_agents/playground/.env.local`

```bash
# ai_agents/playground/.env.local
# 阿里云 RTC 配置
NEXT_PUBLIC_ALI_RTC_APP_ID=your_ali_rtc_app_id
NEXT_PUBLIC_ALI_RTC_APP_KEY=your_ali_rtc_app_key

# 开发环境配置
NEXT_PUBLIC_API_BASE_URL=http://localhost:8080
```

### 1.3 .env.production 文件配置

**修改文件**: `ai_agents/playground/.env.production`

```bash
# ai_agents/playground/.env.production
# 阿里云 RTC 配置
NEXT_PUBLIC_ALI_RTC_APP_ID=your_production_ali_rtc_app_id
NEXT_PUBLIC_ALI_RTC_APP_KEY=your_production_ali_rtc_app_key

# 生产环境配置
NEXT_PUBLIC_API_BASE_URL=https://your-production-domain.com
```

## 2. 后端环境变量配置

### 2.1 application.yml 配置

**修改文件**: `ai_agents/addons/server/src/main/resources/application.yml`

**修改前**:

```yaml
# ai_agents/addons/server/src/main/resources/application.yml
agora:
  app:
    id: ${AGORA_APP_ID}
    certificate: ${AGORA_APP_CERTIFICATE}
```

**修改后**:

```yaml
# ai_agents/addons/server/src/main/resources/application.yml
ali:
  app:
    id: ${ALI_APP_ID}
    key: ${ALI_APP_KEY}
```

### 2.2 环境变量

**修改前环境变量**:

```bash
export AGORA_APP_ID="your_agora_app_id"
export AGORA_APP_CERTIFICATE="your_agora_app_certificate"
```

**修改后环境变量**:

```bash
export ALI_APP_ID="your_ali_app_id"
export ALI_APP_KEY="your_ali_app_key"
```

## 3. 配置迁移脚本

### 3.1 前端配置迁移脚本

```bash
#!/bin/bash
# migrate_frontend_config.sh

echo "开始迁移前端配置..."

# 备份原配置文件
cp ai_agents/playground/.env ai_agents/playground/.env.backup
cp ai_agents/playground/.env.local ai_agents/playground/.env.local.backup
cp ai_agents/playground/.env.production ai_agents/playground/.env.production.backup

# 删除Agora配置
sed -i '' '/NEXT_PUBLIC_AGORA_APP_ID/d' ai_agents/playground/.env
sed -i '' '/NEXT_PUBLIC_AGORA_APP_CERTIFICATE/d' ai_agents/playground/.env

# 添加阿里云配置
echo "NEXT_PUBLIC_ALI_RTC_APP_ID=your_ali_rtc_app_id" >> ai_agents/playground/.env
echo "NEXT_PUBLIC_ALI_RTC_APP_KEY=your_ali_rtc_app_key" >> ai_agents/playground/.env

echo "前端配置迁移完成"
```

### 3.2 后端配置迁移脚本

```bash
#!/bin/bash
# migrate_backend_config.sh

echo "开始迁移后端配置..."

# 备份原配置文件
cp ai_agents/addons/server/src/main/resources/application.yml ai_agents/addons/server/src/main/resources/application.yml.backup

# 删除Agora配置
sed -i '' '/agora:/,/certificate:/d' ai_agents/addons/server/src/main/resources/application.yml

# 添加阿里云 RTC 配置到 application.yml
echo "ali:" >> ai_agents/addons/server/src/main/resources/application.yml
echo "  rtc:" >> ai_agents/addons/server/src/main/resources/application.yml
echo "    app:" >> ai_agents/addons/server/src/main/resources/application.yml
echo "      id: \${ALI_RTC_APP_ID}" >> ai_agents/addons/server/src/main/resources/application.yml
echo "      key: \${ALI_RTC_APP_KEY}" >> ai_agents/addons/server/src/main/resources/application.yml

echo "后端配置迁移完成"
```

### 3.3 环境变量迁移脚本

```bash
#!/bin/bash
# migrate_env_vars.sh

echo "开始迁移环境变量..."

# 删除Agora环境变量
unset AGORA_APP_ID
unset AGORA_APP_CERTIFICATE

# 设置阿里云环境变量
export ALI_APP_ID="your_ali_app_id"
export ALI_APP_KEY="your_ali_app_key"

# 更新 .bashrc 或 .zshrc
echo "export ALI_APP_ID=\"your_ali_app_id\"" >> ~/.bashrc
echo "export ALI_APP_KEY=\"your_ali_app_key\"" >> ~/.bashrc

echo "环境变量迁移完成"
```

## 4. 配置验证

### 4.1 前端配置验证

```bash
# 验证前端环境变量
echo "验证前端配置..."
grep -E "NEXT_PUBLIC_ALI_RTC" ai_agents/playground/.env
grep -E "NEXT_PUBLIC_AGORA" ai_agents/playground/.env || echo "Agora配置已删除"
```

### 4.2 后端配置验证

```bash
# 验证后端配置文件
echo "验证后端配置..."
grep -A 5 "ali:" ai_agents/addons/server/src/main/resources/application.yml
grep -A 5 "agora:" ai_agents/addons/server/src/main/resources/application.yml || echo "Agora配置已删除"
```

### 4.3 环境变量验证

```bash
# 验证环境变量
echo "验证环境变量..."
echo "ALI_APP_ID: $ALI_APP_ID"
echo "ALI_APP_KEY: $ALI_APP_KEY"
echo "AGORA_APP_ID: $AGORA_APP_ID" || echo "Agora环境变量已删除"
```

## 5. 配置清理

### 5.1 清理Agora相关配置

```bash
# 清理前端Agora配置
find ai_agents/playground -name "*.env*" -exec sed -i '' '/AGORA/d' {} \;

# 清理后端Agora配置
find ai_agents/addons/server -name "*.yml" -exec sed -i '' '/agora:/,/certificate:/d' {} \;

# 清理环境变量
unset AGORA_APP_ID AGORA_APP_CERTIFICATE
```

### 5.2 验证清理结果

```bash
# 验证清理结果
echo "验证清理结果..."
grep -r "AGORA" ai_agents/playground/ || echo "前端Agora配置已清理"
grep -r "agora" ai_agents/addons/server/ || echo "后端Agora配置已清理"
```

## 6. 配置迁移检查清单

- [ ] 前端环境变量已从Agora迁移到阿里云
- [ ] 后端配置文件已从Agora迁移到阿里云
- [ ] 环境变量已从Agora迁移到阿里云
- [ ] 所有Agora相关配置已清理
- [ ] 阿里云配置已正确设置
- [ ] 配置验证通过
- [ ] 环境变量验证通过
