# 适配器模式实现 - 2: 具体适配器

## Agora RTC 适配器实现

```typescript
// adapters/AgoraRTCAdapter.ts
import AgoraRTC, {
  IAgoraRTCClient,
  IMicrophoneAudioTrack,
  ICameraVideoTrack,
} from "agora-rtc-sdk-ng";
import { IRTCClient, IAudioTrack, IVideoTrack } from "../interfaces/IRTCClient";

export class AgoraRTCAdapter implements IRTCClient {
  private client: IAgoraRTCClient;
  private localAudioTrack?: IMicrophoneAudioTrack;
  private localVideoTrack?: ICameraVideoTrack;

  constructor() {
    this.client = AgoraRTC.createClient({
      mode: "rtc",
      codec: "vp8",
    });
  }

  async join(channel: string, token: string, uid: string): Promise<void> {
    await this.client.join(token, channel, uid);
  }

  async leave(): Promise<void> {
    await this.client.leave();
  }

  async createAudioTrack(): Promise<IAudioTrack> {
    this.localAudioTrack = await AgoraRTC.createMicrophoneAudioTrack({
      encoderConfig: "music_standard",
      AEC: true,
      AGC: true,
      ANS: true,
    });
    return this.localAudioTrack as IAudioTrack;
  }

  async createVideoTrack(): Promise<IVideoTrack> {
    this.localVideoTrack = await AgoraRTC.createCameraVideoTrack({
      encoderConfig: "1080p_1",
      facingMode: "user",
      optimizationMode: "detail",
    });
    return this.localVideoTrack as IVideoTrack;
  }

  async publish(): Promise<void> {
    const tracks: any[] = [];

    if (this.localAudioTrack) {
      tracks.push(this.localAudioTrack);
    }

    if (this.localVideoTrack) {
      tracks.push(this.localVideoTrack);
    }

    if (tracks.length > 0) {
      await this.client.publish(tracks);
    }
  }

  destroy(): void {
    if (this.localAudioTrack) {
      this.localAudioTrack.close();
    }

    if (this.localVideoTrack) {
      this.localVideoTrack.close();
    }

    this.client.removeAllListeners();
  }

  on(event: string, handler: Function): void {
    this.client.on(event, handler);
  }

  off(event: string, handler: Function): void {
    this.client.off(event, handler);
  }
}
```

## 阿里云 RTC 适配器实现

```typescript
// adapters/AliRTCAdapter.ts
import DingRTC, {
  DingRTCClient,
  MicrophoneAudioTrack,
  CameraVideoTrack,
} from "dingrtc";
import { IRTCClient, IAudioTrack, IVideoTrack } from "../interfaces/IRTCClient";

export class AliRTCAdapter implements IRTCClient {
  private client: DingRTCClient;
  private localAudioTrack?: MicrophoneAudioTrack;
  private localVideoTrack?: CameraVideoTrack;

  constructor() {
    this.client = DingRTC.createClient();
  }

  async join(channel: string, token: string, uid: string): Promise<void> {
    await this.client.join(token, channel, uid);
  }

  async leave(): Promise<void> {
    await this.client.leave();
  }

  async createAudioTrack(): Promise<IAudioTrack> {
    this.localAudioTrack = await DingRTC.createMicrophoneAudioTrack();
    return this.localAudioTrack as IAudioTrack;
  }

  async createVideoTrack(): Promise<IVideoTrack> {
    this.localVideoTrack = await DingRTC.createCameraVideoTrack();
    return this.localVideoTrack as IVideoTrack;
  }

  async publish(): Promise<void> {
    const tracks: any[] = [];

    if (this.localAudioTrack) {
      tracks.push(this.localAudioTrack);
    }

    if (this.localVideoTrack) {
      tracks.push(this.localVideoTrack);
    }

    if (tracks.length > 0) {
      await this.client.publish(tracks);
    }
  }

  destroy(): void {
    if (this.localAudioTrack) {
      this.localAudioTrack.close();
    }

    if (this.localVideoTrack) {
      this.localVideoTrack.close();
    }

    this.client.destroy();
  }

  on(event: string, handler: Function): void {
    this.client.on(event, handler);
  }

  off(event: string, handler: Function): void {
    this.client.off(event, handler);
  }
}
```
