# 迁移实施总结 - 前端部分

## 前端核心文件

**需要修改的文件**:

- `ai_agents/playground/src/components/RTCManager.ts`
- `ai_agents/playground/src/hooks/useRTC.ts`
- `ai_agents/playground/src/common/request.ts`
- `ai_agents/playground/src/config/rtc.ts`
- `ai_agents/playground/src/config/env.ts`

**需要新增的文件**:

- `ai_agents/playground/src/types/rtc.ts` (类型定义)
- `ai_agents/playground/src/utils/rtcAdapter.ts` (适配器)

## 前端迁移步骤

### 步骤1: 前端RTC客户端迁移

1. **更新RTC管理器**:

```typescript
// RTCManager.ts
export class RTCManager {
  private client: DingRTCClient;

  constructor() {
    this.client = DingRTC.createClient();
  }
}
```

2. **更新Token请求**:

```typescript
// request.ts
export const requestToken = async (
  channel: string,
  uid: string
): Promise<string> => {
  const response = await fetch("/api/token/generate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ channel, uid }),
  });
  return response.text();
};
```

3. **更新RTC Hook**:

```typescript
// useRTC.ts
export const useRTC = () => {
  const [client, setClient] = useState<DingRTCClient | null>(null);

  const joinChannel = useCallback(async (channel: string, uid: string) => {
    const rtcClient = DingRTC.createClient();
    const token = await requestToken(channel, uid);
    await rtcClient.join({
      appId: process.env.REACT_APP_ALI_APP_ID!,
      token,
      uid,
      channel,
      userName: `user_${uid}`,
    });
    setClient(rtcClient);
  }, []);

  return { joinChannel, leaveChannel: () => client?.leave() };
};
```

### 步骤2: 前端配置和环境变量迁移

1. **更新环境变量**:

```bash
# .env
REACT_APP_ALI_APP_ID=your_ali_app_id
```

2. **更新应用配置**:

```typescript
// config/rtc.ts
export const rtcConfig = {
  appId: process.env.REACT_APP_ALI_APP_ID,
  token: null,
  channel: null,
  uid: null,
};
```

### 步骤3: 前端类型定义

```typescript
// types/rtc.ts
export interface IRTCClient {
  join(token: string, channel: string, uid: string): Promise<void>;
  leave(): Promise<void>;
  publish(tracks: any[]): Promise<void>;
  unpublish(track: any): Promise<void>;
  subscribe(user: any, mediaType: string): Promise<any>;
  on(event: string, callback: Function): void;
}

export interface IRTCTokenService {
  generateToken(channel: string, uid: string): Promise<string>;
}
```

### 步骤4: 前端适配器模式

```typescript
// utils/rtcAdapter.ts
export class RTCCAdapter {
  private client: IRTCClient;

  constructor() {
    this.client = DingRTC.createClient();
  }

  async join(token: string, channel: string, uid: string): Promise<void> {
    await this.client.join(token, channel, uid);
  }

  async leave(): Promise<void> {
    await this.client.leave();
  }
}
```
