# 代码重构示例 - 2: 后端重构

## 参考文档

- [阿里云RTC Token生成文档](https://help.aliyun.com/document_detail/2864109.html)
- [阿里云RTC Token验证文档](https://help.aliyun.com/document_detail/159037.html)

## 重构思路

### 1. 直接替换策略

将Agora RTC Token生成直接替换为阿里云RTC Token生成，不保留双服务支持。

### 2. 重构后的架构

```java
// TokenService.java - 完全替换为阿里云实现
@Service
public class TokenService {
    @Value("${ali.app.id}")
    private String appId;

    @Value("${ali.app.key}")
    private String appKey;

    @Autowired
    private AliRtcTokenGenerator tokenGenerator;

    public String generateToken(String channelId, String userId) {
        try {
            return tokenGenerator.generateDefaultToken(appId, appKey, channelId, userId);
        } catch (Exception e) {
            throw new RuntimeException("Failed to generate Ali RTC token", e);
        }
    }
}
```

### 3. 配置简化

```yaml
# application.yml - 只保留阿里云配置
ali:
  app:
    id: ${ALI_APP_ID}
    key: ${ALI_APP_KEY}
```

## 重构优势

1. **简化架构**: 移除复杂的服务选择逻辑
2. **减少依赖**: 移除Agora相关依赖
3. **统一配置**: 只维护一套配置
4. **性能提升**: 减少不必要的服务选择开销

## 迁移步骤

1. **删除Agora依赖**: 移除Agora SDK和相关配置
2. **替换TokenService**: 直接使用阿里云实现
3. **更新配置**: 只保留阿里云配置
4. **更新环境变量**: 只设置阿里云环境变量

## 详细实现

完整的阿里云RTC Token实现请参考：

- [09*阿里云RTC_Token*官方实现补充.md](./09_阿里云RTC_Token_官方实现补充.md)
