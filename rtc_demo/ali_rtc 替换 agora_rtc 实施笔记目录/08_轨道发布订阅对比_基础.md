# 轨道发布订阅对比 - 1: 轨道发布

## Agora RTC 轨道发布

```typescript
// 发布单个轨道
await client.publish(audioTrack);
await client.publish(videoTrack);

// 发布多个轨道
await client.publish([audioTrack, videoTrack]);

// 发布屏幕共享
await client.publish(screenTrack);
```

## 阿里云 RTC 轨道发布

```typescript
// 发布单个轨道
await client.publish(audioTrack);
await client.publish(videoTrack);

// 发布多个轨道
await client.publish([audioTrack, videoTrack]);

// 发布屏幕共享
await client.publish(screenTrack);
```

## 轨道发布状态监控

**Agora RTC**:

```typescript
// 发布状态变化事件
client.on("stream-published", (stream) => {
  console.log("轨道发布成功:", stream.getId());
});

client.on("stream-unpublished", (stream) => {
  console.log("轨道取消发布:", stream.getId());
});
```

**阿里云 RTC**:

```typescript
// 发布状态变化事件
client.on("stream-published", (stream) => {
  console.log("轨道发布成功:", stream.getId());
});

client.on("stream-unpublished", (stream) => {
  console.log("轨道取消发布:", stream.getId());
});
```

## 轨道类型定义

**Agora RTC**:

```typescript
import { ILocalTrack } from "agora-rtc-sdk-ng";
let tracks: ILocalTrack[] = [];
```

**阿里云 RTC**:

```typescript
import { LocalTrack } from "dingrtc";
let tracks: LocalTrack[] = [];
```

### playground 具体修改点

```typescript
// 文件: ai_agents/playground/src/manager/rtc/rtc.ts

// 1. 类型定义修改
// 从:
import { IUserTracks } from "./types";

// 到:
import { IUserTracks } from "./types";

// 2. 发布方法修改 - 无需修改，API一致
async publish() {
  const tracks = [];
  if (this.localTracks.videoTrack) {
    tracks.push(this.localTracks.videoTrack);
  }
  if (this.localTracks.audioTrack) {
    tracks.push(this.localTracks.audioTrack);
  }
  if (tracks.length) {
    await this.client.publish(tracks);
  }
}

// 3. 轨道切换方法修改 - 无需修改，API一致
async switchVideoSource(type: VideoSourceType) {
  if (type === VideoSourceType.SCREEN) {
    await this.createScreenShareTrack();
    if (this.localTracks.screenTrack) {
      this.client.unpublish(this.localTracks.videoTrack);
      this.localTracks.videoTrack?.close();
      this.localTracks.videoTrack = undefined;
      this.client.publish(this.localTracks.screenTrack);
      this.emit("localTracksChanged", this.localTracks);
    }
  } else if (type === VideoSourceType.CAMERA) {
    await this.createCameraTracks();
    if (this.localTracks.videoTrack) {
      this.client.unpublish(this.localTracks.screenTrack);
      this.localTracks.screenTrack?.close();
      this.localTracks.screenTrack = undefined;
      this.client.publish(this.localTracks.videoTrack);
      this.emit("localTracksChanged", this.localTracks);
    }
  }
}
```

// 3. 轨道切换方法修改
// 从:
async switchVideoSource(type: VideoSourceType) {
  if (type === VideoSourceType.SCREEN) {
    await this.createScreenShareTrack();
    if (this.localTracks.screenTrack) {
      this.client.unpublish(this.localTracks.videoTrack);
      this.localTracks.videoTrack?.close();
      this.localTracks.videoTrack = undefined;
      this.client.publish(this.localTracks.screenTrack);
      this.emit("localTracksChanged", this.localTracks);
    }
  } else if (type === VideoSourceType.CAMERA) {
    await this.createCameraTracks();
    if (this.localTracks.videoTrack) {
      this.client.unpublish(this.localTracks.screenTrack);
      this.localTracks.screenTrack?.close();
      this.localTracks.screenTrack = undefined;
      this.client.publish(this.localTracks.videoTrack);
      this.emit("localTracksChanged", this.localTracks);
    }
  }
}

// 到:
async switchVideoSource(type: VideoSourceType) {
  if (type === VideoSourceType.SCREEN) {
    await this.createScreenShareTrack();
    if (this.localTracks.screenTrack) {
      this.client.unpublish(this.localTracks.videoTrack);
      this.localTracks.videoTrack?.close();
      this.localTracks.videoTrack = undefined;
      this.client.publish(this.localTracks.screenTrack);
      this.emit("localTracksChanged", this.localTracks);
    }
  } else if (type === VideoSourceType.CAMERA) {
    await this.createCameraTracks();
    if (this.localTracks.videoTrack) {
      this.client.unpublish(this.localTracks.screenTrack);
      this.localTracks.screenTrack?.close();
      this.localTracks.screenTrack = undefined;
      this.client.publish(this.localTracks.videoTrack);
      this.emit("localTracksChanged", this.localTracks);
    }
  }
}
```
